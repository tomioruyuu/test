<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- link font awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- link font gg -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,200&display=swap"
      rel="stylesheet"
    />
    <title>Document</title>
  </head>
  <body>
    <style>
      /* general */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        font-size: 62.5%;
      }

      body {
        width: 100%;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      body,
      html,
      input,
      select,
      textarea {
        font-family: "Poppins", sans-serif;
      }

      /*common */

      /* code */

      /* phần nút */
      .btn-block {
        display: flex;
        gap: 30px;
        padding: 30px 10px;
        box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
      }

      .btn-item button {
        border: none;
        outline: none;
        background-color: #08aeea;
        background-image: linear-gradient(0deg, #08aeea 0%, #2af598 100%);
        color: #fff;
        font-size: 2em;
        padding: 8px 12px;
        border-radius: 999px;
        cursor: pointer;
      }

      /* phần form đăng kí mua hàng */
      .form {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        background-color: rgba(0, 0, 0, 0.5);
        height: 100vh;
        width: 100vw;
      }

      .form-location {
        width: 50vw;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: formInTop 0.6s linear forwards;
      }

      @keyframes formInTop {
        from {
          opacity: 0;
          top: 25%;
        }
        to {
          opacity: 1;
          top: 50%;
        }
      }

      .form__heading {
        position: relative;
        width: 100%;
        background-color: #31e1f7;
        text-align: center;
        color: #fff;
        padding: 15px 0;
      }

      .form__heading .close-form {
        display: inline;
        position: absolute;
        top: 0;
        right: 0;
        font-size: 2rem;
        padding: 10px 12px;
      }

      .form__heading .close-form:hover {
        cursor: pointer;
        background-color: #ddd8d8;
      }

      .form__heading h2 {
        font-size: 2.5em;
      }

      .form__heading p {
        font-size: 1.5em;
      }

      #register-form {
        background: #fff;
        padding-bottom: 30px;
        padding: 30px 30px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group + .form-group {
        padding-top: 15px;
      }

      .form-group label {
        font-size: 1.2rem;
        font-weight: 600;
        padding-bottom: 3px;
      }

      .form-group input {
        outline: none;
        border: 1px solid #ddd;
        padding: 8px 4px;
        font-size: 1.4rem;
        border-radius: 4px;
      }

      .form-group input:hover {
        border-color: #31e1f7;
      }

      .form-group.invalid input {
        border-color: red;
      }

      .form-group.invalid span {
        color: red;
        font-weight: 500;
        font-size: 1.1rem;
      }

      #register-form button {
        display: inline-block;
        width: 120px;
        margin-left: 100%;
        transform: translateX(-100%);
        margin-top: 20px;
        color: #fff;
        font-size: 1.75em;
        padding: 10px 0;
        border-radius: 999px;
        background-color: #31e1f7;
        border: none;
        outline: none;
      }

      #register-form button:hover {
        cursor: pointer;
        opacity: 0.8;
      }

      /* phần thông báo */
      #notifications {
        position: fixed;
        top: 0;
        right: 0;
        z-index: 10;
        transition: all 1s linear;
      }

      .inform {
        margin-top: 20px;
        padding: 15px 8px;
        display: flex;
        gap: 5px;
        align-items: center;
        border-radius: 5px 0 0 5px;
        box-shadow: rgba(0, 0, 0, 0.04) 0px 3px 5px;
        background-color: #fff;
        transition: all 1s linear;
        animation: slideInRight 0.5s linear forwards,
          disappear 1s linear 3s forwards;
      }

      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes disappear {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      .inform .icon-backgroud {
        width: 25px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }

      .inform .success__icon-backgroud {
        background-color: #9cff2e;
      }

      .inform .icon-backgroud .icon-inform {
        font-size: 20px;
        padding-top: 2px;
        font-size: 15px;
        color: #fff;
      }

      .inform .notifications-title {
        font-size: 16px;
        color: #9cff2e;
      }

      .inform .notifications-title.success {
        color: #9cff2e;
      }

      .inform.inform-success {
        border-left: 5px solid #9cff2e;
      }

      .inform.inform-error {
        border-left: 5px solid #ff0000;
      }

      .inform .error__icon-backgroud {
        background-color: #ff0000;
      }

      .inform .notifications-title.error {
        color: #ff0000;
      }
    </style>

    <!-- PHẦN HTML -->

    <div class="main">
      <div class="btn-block">
        <div class="btn-item">
          <button>Mua hàng</button>
        </div>
        <div class="btn-item">
          <button>Mua hàng</button>
        </div>
        <div class="btn-item">
          <button>Mua hàng</button>
        </div>
      </div>

      <div class="form">
        <div class="form-location">
          <div class="form__heading">
            <h2>Đăng ký</h2>
            <p>
              Cảm ơn quý khách đã ủng hộ
              <i class="fa-solid fa-heart" style="color: #ff0000"></i>
            </p>
            <i class="fa-solid fa-xmark close-form"></i>
          </div>
          <form action="http://localhost:3000/inforUser" method="post" id="register-form">
            <div class="form-group">
              <label for="fullname">Tên đầy đủ</label>
              <input
                type="text"
                placeholder="Nhập tên"
                id="fullname"
                name="fullname"
              />
              <span class="form-message"></span>
            </div>

            <div class="form-group">
              <label for="email">Email</label>
              <input
                type="tel"
                placeholder="Nhập email"
                id="email"
                name="email"
              />
              <span class="form-message"></span>
            </div>

            <div class="form-group">
              <label for="phone">Số điện thoại</label>
              <input
                type="tel"
                placeholder=" Nhập số điện thoại"
                id="phone"
                name="phone"
              />
              <span class="form-message"></span>
            </div>

            <div class="form-group">
              <label for="address">Địa chỉ</label>
              <input
                type="text"
                placeholder="Nhập địa chỉ"
                id="address"
                name="address"
              />
              <span class="form-message"></span>
            </div>

            <button>Gửi</button>
          </form>
        </div>
      </div>

      <div id="notifications"></div>
    </div>
  </body>

  <script>
    function handelBtns() {
      let main = document.querySelector(".btn-block");
      let form = document.querySelector(".form");
      let formLocation = form.querySelector(".form-location");

      // reset lại form khi bấm đóng
      function handleReset() {
        let formRegister = formLocation.querySelector("#register-form");
        let formGroups = formRegister.querySelectorAll(".form-group");

        for (let formGroup of formGroups) {
          if (formGroup.classList.contains("invalid")) {
            let errMessage = formGroup.querySelector(".form-message");
            errMessage.innerText = "";
            formGroup.classList.remove("invalid");
          }
        }
      }

      if (main) {
        // lấy ra những nút đăng kí
        let buyBtns = main.querySelectorAll(".btn-item");
        let closeForm = form.querySelector(".close-form");

        // lọc qua từng nút đăng kí
        for (buyBtn of buyBtns) {
          // sự kiện click vào từng nút
          buyBtn.onclick = function () {
            form.style.display = "block";
          };
        }

        //tắt form qua khoảng trống
        form.onclick = function (e) {
          form.style.display = "none";
          handleReset();
        };

        // dừng sự kiện nổi bọt ở thẻ chứa cả cái forn bao gồm luôn phần heading
        formLocation.onclick = function (e) {
          e.stopPropagation();
        };

        // tắt form qua nút close
        closeForm.onclick = function () {
          form.style.display = "none";
          handleReset();
        };
      }
    }

    // phần in ra thông báo
    function showInform(info) {
      let notificationForm = document.querySelector(info.notification);
      let inform = document.createElement("div");
      inform.classList.add("inform", info.modal);

      let content = `
                      <div class="icon-backgroud ${info.status}__icon-backgroud">
                        <i class="${info.icon}"></i>
                      </div>
                      <p class="notifications-title ${info.status}">${info.title}</p>
      `;

      inform.innerHTML = content;

      notificationForm.append(inform);

      setTimeout(function () {
        inform.remove();
      }, 4000);
    }

    function Validator(options) {
      // lấy form element
      let formElement = document.querySelector(options.form);

      // lấy ra phần tử tra của 1 phần tử
      function getParent(input, selector) {
        while (input.parentNode) {
          if (input.parentNode.matches(selector)) {
            return input.parentNode;
          }

          input = input.parentNode;
        }
      }

      // thực hiện validate form
      function validate(inputElement, rule) {
        let errElement = getParent(
          inputElement,
          options.formGroup
        ).querySelector(options.errElement);

        let errMessage;

        let ruleInputs = formRules[inputElement.name];

        for (let ruleInput of ruleInputs) {
          errMessage = ruleInput(inputElement.value);
          if (errMessage) break;
        }

        if (errMessage) {
          getParent(inputElement, options.formGroup).classList.add("invalid");
          errElement.innerText = errMessage;
        } else {
          getParent(inputElement, options.formGroup).classList.remove(
            "invalid"
          );
          errElement.innerText = "";
        }

        return !errMessage;
      }

      // tạo biến lưu trữ
      let formRules = {};

      function resetValue(inputs) {
        for (let input of inputs ) {
          input.value = ''
        }
      }

      // kiểm tra xem form element có lấy đúng hay không
      if (formElement) {
        options.rules.forEach((rule) => {
          // lấy ra các phần tử input
          let inputElement = formElement.querySelector(rule.selector);

          if (!Array.isArray(formRules[inputElement.name])) {
            formRules[inputElement.name] = [rule.test];
          } else {
            formRules[inputElement.name].push(rule.test);
          }

          if (inputElement) {
            // thực hiện sự kiện blur
            inputElement.onblur = function () {
              validate(inputElement, rule);

              // thực hiện sự kiện input
              inputElement.oninput = function () {
                let errElement = getParent(
                  inputElement,
                  options.formGroup
                ).querySelector(options.errElement);

                getParent(inputElement, options.formGroup).classList.remove(
                  "invalid"
                );
                errElement.innerText = "";
              };
            };
          }
        });

        // sự kiện submit
        formElement.onsubmit = function (e) {
          // dừng sự kiến submit mặc định của thẻ form
          e.preventDefault();

          let isFormValid = true;

          // thực hiệN validate tất cả các thẻ input
          options.rules.forEach((rule) => {
            // lấy ra các phần tử input
            let inputElement = formElement.querySelector(rule.selector);

            let isValid = validate(inputElement);

            if (!isValid) {
              isFormValid = false;
            }
          });

          // show message lỗi khi giá trị bị thiếu
          if (!isFormValid) {
            showInform({
              title: "Vui lòng điền đầy đủ thông tin",
              icon: "fa-solid fa-exclamation icon-inform",
              modal: "inform-error",
              notification: "#notifications",
              status: "error",
            });
          }

          if (isFormValid) {
            let inputElement = formElement.querySelectorAll(
              "[name]:not(:disabled)"
            );

            // lấy ra giá trị của từng trường và trả về dưới dạng tên và giá trị thông qua reduce
            let valueInputElement = Array.from(inputElement).reduce(
              (values, input) => {
                values[input.name] = input.value;
                return values;
              },
              {}
            );

            if (typeof options.callback === "function") {
              options.callback(valueInputElement);
              let form = document.querySelector(".form");
              form.style.display = "none";
            } else {
              formElement.submit();
            }

            // show message thành công khi có đầy đủ giá trị
            showInform({
              title: "Bạn đã mua hàng thành công",
              icon: "fa-solid fa-check icon-inform",
              modal: "inform-success",
              notification: "#notifications",
              status: "success",
            });

            // reset lại giá trị
            resetValue(inputElement);
          }
        };
      }
    }

    function isRequired(selector) {
      return {
        selector,
        test(valueInput) {
          return valueInput ? undefined : "Vui lòng nhập trường này";
        },
      };
    }

    function isEmail(selector) {
      return {
        selector,
        test(valueInput) {
          let regexEmai = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
          return regexEmai.test(valueInput)
            ? undefined
            : "Địa chỉ email không hợp lệ";
        },
      };
    }

    function isPhone(selector) {
      return {
        selector,
        test(valueInput) {
          let regexPhone = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
          return regexPhone.test(valueInput)
            ? undefined
            : "Số điện thoại không hợp lệ";
        },
      };
    }

    function start() {
      handelBtns();

      Validator({
        form: "#register-form",
        formGroup: ".form-group",
        errElement: ".form-message",
        formBtn: "button",
        rules: [
          isRequired("#fullname"),
          isRequired("#email"),
          isEmail("#email"),
          isRequired("#phone"),
          isPhone("#phone"),
          isRequired("#address"),
        ],
        // callback(data) {
        //   console.log(data);
        // },
      });
    }

    start();
  </script>
</html>
